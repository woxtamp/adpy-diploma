# Курсовая работа - Профессиональная работа с Python (VKinder)

Результатом выполнения курсовой работы по блоку "Профессиональная
работа с Python" является чат-бот для сообщества ВКонтакте который 
находит пользователей противоположного пола и отправляет топ-3 фотографии
профиля и ссылку на его страницу.

Проект состоит из следующих модулей:

* _main.py_ - основной модуль программы для запуска бота

* _vk_bot_api.py_ - реализует диалог бота с пользователем

* _vk_group_api.py_ - реализует вызов методов из API ВКонтакте
которые можно выполнять с ключом доступа сообщества

* _vk_user_api.py_ - реализует вызов методов из API ВКонтакте
которые можно выполнять с ключом доступа пользователя

* _db_worker.py_ - реализует вспомогательные методы для работы с БД -
чтение и запись данных

В _requirements.txt_ описаны внешние зависимости, необходимые для успешного
запуска проекта (можно установить путём выполнения команды
`pip install -r requirements.txt`).

Также в корне проекта необходимо наличие файла _.env_, для работы
с которым используется библиотека python-dotenv и где должны быть 
представлены следующие переменные:

* _VK_GROUP_TOKEN_ - токен сообщества ВКонтакта

* _DSN_ - ссылка для подключения к БД PostgreSQL вида
`postgresql+psycopg2://<user>:<password>>@<host>/<db_name>>`

* _USER_TOKEN_URL_ - ссылка для получения ключа доступа пользователя
(https://vk.com/dev/implicit_flow_user)

В каталоге _db_creation_ содержится описание запросов для создания таблиц
в БД и их графическое представление.

Нюансы реализации:

* Токен пользователя запрашивается у пользователя в виде ссылки, далее
с использованием регулярного выражение из ссылки берётся нужная строка,
сохраняется в БД и в дальнейшем используется для вызова соответствующих 
методов. Исходя из того, что время жизни токена составляет сутки, 
реализован специальный механизм обновления истекшего токена, который
в течение суток запрашивается только один раз.

* Взаимодействие пользователя с ботом реализовано преимущественно
посредством нажатия одной кнопки - _vkinder_ для чего были использованы
специализированные методы _vk_api_.

* В зависимости от того указан ли в профиле пользователя город или нет
поиск осуществляется либо по идентификатору, либо по строке.

* Для историчности в БД сохраняется поисковый запрос пользователя.

* Проверка токена пользователя на истечение реализована посредством
прибавления 86370 секунд к текущему _timestamp_, записи этого значения
в БД и последующего сравнения текущего _timestamp_ с записью.

* Все кейсы, связанные с потенциальными ошибками при ручном 
пользовательском вводе обрабатываются индивидуально.